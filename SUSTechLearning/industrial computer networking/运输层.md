- 运输层的功能
	- 提供了主机**进程**之间端到端的**服务**
		- 服务：进程间的逻辑通信
	- 复用和分用
		- 在一台主机中经常有多个应用进程同时分别和另一台主机中的多个应用进程通信
		- 复用
			- 应用进程都可以通过运输层再传送到 IP 层
		- 分用
			- 运输层从 IP 层收到发送给应用进程的数据后，必须分别交付给指明的各应用进程。
- 范围
	- 只有位于网络**边缘部分**的主机的协议栈才有运输层
	- 网络核心部分中的路由器在转发分组时都只用到下三层的功能
- 和网络层区别
	- 网络层是为主机之间提供逻辑通信
	- 运输层为应用进程之间提供端到端的逻辑通信
- 两种运输协议
	- TCP
		- 提供面向连接的服务
		- 传送的数据单位协议是 TCP 报文段
		- TCP 不提供广播或多播服务
		- 由于 TCP 要提供可靠的、面向连接的运输服务，因此不可避免地增加了许多的开销
	- UDP
		- 提供无连接服务
		- 传送的数据单位协议是 UDP 报文或用户数据报
		- 支持单播、多播和广播
		- 对方的运输层在收到 UDP 报文后，不需要给出任何确认
		- 虽然 UDP **不提供可靠交付**，但在某些情况下 UDP 是一种最有效的工作方式
	- 典型应用
		- ![[Pasted image 20241113165918.png]]
## 运输层的端口
- 运行在计算机中的进程是用进程标识符来标志的。但运行在应用层的各种应用进程却不应当让计算机 操作系统指派它的进程标识符。这是因为在互联网 上使用的计算机的操作系统种类很多，而不同的操 作系统又使用不同格式的进程标识符。
	- 解决办法
		- 在运输层使用协议端口号 (protocol port number)，或 通常简称为端口 (port)。把端口设为通信的抽象终点。
- 软件端口
	- 协议栈层间的抽象的协议端口
	- 是应用层的各种协议进程与运输实体进行层间交互的地点
	- 不同系统实现端口的方法可以不同
- 硬件端口
	- 不同硬件设备进行交互的接口
## UDP
### UDP 特点
- (1) UDP 是无连接的，发送数据之前不需要建立 连接，因此减少了开销和发送数据之前的时延
- (2) UDP 使用尽最大努力交付，即**不保证可靠交付**，因此主机不需要维持复杂的连接状态表
- (3) UDP 是**面向报文**的。
	- 发送方：UDP 对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。
	- 接收方： UDP 对 IP 层交上来的 UDP 用户数据报，去除首部后就原封不动地交付上层的应用进程，**一次交付一个完整的报文**。
	- 应用程序必须选择合适大小的报文
		- 若报文太长，UDP 把它交给 IP 层后，IP 层在传送 时可能要进行分片，这会降低 IP 层的效率
		- 若报文太短，UDP 把它交给 IP 层后，会使 IP 数据 报的首部的相对长度太大，这也降低了 IP 层的效率
- (4) UDP **没有拥塞控制**，因此网络出现的拥塞不会使源主机的发送速率降低。这对某些实时应 用是很重要的。很适合多媒体通信的要求。
- (5) UDP 支持一对一、一对多、多对一和多对多的交互通信
- (6) UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短
### UDP 的首部格式
- 用户数据报 UDP 有两个字段：数据字段和首部字段。
	- ![[Pasted image 20241113172025.png]]
	- 首部
		- 端口
			- 当运输层从 IP 层收到 UDP 数据报时，就根据首部中的 目的端口，把 UDP 数据报通过相应的端口，上交最后的 终点——应用进程。
	- 伪首部
		- 在计算检验和时，临时把“伪首部”和 UDP 用户数 据报连接在一起。**伪首部仅仅是为了计算检验和。**
		- 检验和：检测 UDP 数据报是否有差错。有错就丢弃。
		- 计算检验和
			- ![[Pasted image 20241113172220.png]]
## TCP
### TCP 特点
- TCP 是面向连接的运输层协议
- 每一条 TCP 连接**只能有两个端点** (endpoint)，每一条 TCP 连接只能是点对点的（一对一）
- TCP 提供可靠交付的服务
- TCP 提供全双工通信
- 面向字节流
	- TCP 中的“流”(stream)指的是流入或流出进程的字节序列
	- 虽然应用程序和 TCP 的交互是一次一个数据块，但 TCP 把应用程序交下来的数据看成仅仅是一连串**无结构**的字节流
	- TCP 接收方应用程序收到的字节流必须和发送 方应用程序发出的字节流完全一样
	- TCP 不关心应用进程一次把多长的报文发送到 TCP 缓存
	- TCP 对连续的字节流进行分段，形成 TCP 报文段
- 流量控制
	- TCP 根据对方给出的窗口值和当前网络拥塞的 程度来决定一个报文段应包含多少个字节 （UDP 发送的报文长度是应用进程给出的）
	- TCP 可把太长的数据块划分短一些再传送
	- TCP 也可等待积累有足够多的字节后再构成报文段发送出去
### TCP 的连接
TCP 连接的端点不是主机，不是主机的 IP 地址，也不是运输层的协议端口。TCP 连接的端点叫做套接字 (socket) 或插口。
端口号拼接到 IP 地址即构成了套接字。
### 可靠传输的原理
#### 停止等待协议
> TL; DR
>每发送完一个分组就停止发 送，等待对方的确认。在收到确认后再发送下 一个分组。

![[Pasted image 20241120165412.png]]
- 出现差错的情况
	- 
#### 连续 ARQ 协议