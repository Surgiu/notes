- 数据链路层使用的信道
	- 点对点
		- 一对一的点对点通信方式。
	- 广播信道
		- 一对多的广播通信方式，必须使用专用的共享信道协议来协调这些主机的数据发送。
- 本章主要研究的问题：
	- 在同一个局域网中，分组怎样由 host A 传到 host B, 但不经过路由器转发。
	- PPP 协议和 CSMA/CD 协议
	- 数据链路层的三个基本问题：封装成帧、透明传输和差错检测
	- 以太网 MAC 层的硬件地址
	- 适配器、转发器、网桥、以太网交换机的作用和使用场景

## 概念
- 链路&数据链路：链路(link) 是一条点到点的物理线路段，中间没有任何其他的交换结点；数据链路(data link) 除了物理线路外，还必须有通信协议来控制这些数据的传输。
- 帧

## 数据链路层三个基本问题
### 封装成帧
>[!note] 定义
>封装成帧(framing) 就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧，确定帧的界限。

- 如何进行帧定界
	- 使用控制字符（SOH 和 EOH）
	- ![[Pasted image 20241105231631.png]]

### 透明传输
无论发送什么样的比特组合的数据，这些数据都能够按照原样没有差错地通过这个数据链路层
- 如何实现透明传输
	- 字节填充法
		- ![[Pasted image 20241105231910.png]]

### 差错检测
- 在传输过程中可能会产生比特差错：1 可能会变成0 而0 也可能变成1。
- 在一段时间内，传输错误的比特占所传输比特总数的 比率称为误码率BER (Bit Error Rate)。
- 误码率与信噪比有很大的关系。
- 如何实现差错检测
	- 循环冗余检验CRC
		- 发送端
			- 先把数据划分为组。假定每组 $k$ 个比特。
			- CRC 运算在每组后面再添加供差错检测用的 n 位冗余码（FCS），然后构成一个帧发送出去。
				-  一共发送 $(k + n)$ 位
				- CRC冗余码的计算
					- 在一组后面添加 n 个0。
					- 得到的(k + n) 位的数模 2除以事先选定好的长度为 (n + 1) 位的除数 P，得出商是 Q 而余数是 R，R 是 n 位。
					- 将余数 R 作为冗余码拼接在数据M后面发送出去。
		- 接收端
			- 对收到的每一帧进行CRC 检验
			- 模 2除以同一个除数 P，若得出的余数 R = 0，则判定这个帧没有差错，就接受(accept)。
			- 若余数 $R \neq 0$，则判定这个帧有差错，就丢弃
		- ![[Pasted image 20241105233226.png]]
		- 局限：
			- 这种检测方法并不能确定究竟是哪一个或哪几个比特出现了差错。
		- 注意：
			- 循环冗余检验CRC 和帧检验序列FCS 并不等同。FCS 可以用 CRC这种方法得出，但CRC 并非 用来获得FCS 的唯一方法。
			- 可靠传输（无差错传输）、无差错接受
				-  可靠传输：数据链路层的发送端发送什么，在接收端就收到什么。
				- 凡是**接收端**数据链路层接受的帧均无差错
				- 仅用循环冗余检验CRC 差错检测技术只能做到 无差错接受
				- 传输差错
					- 比特差错
					- 传输差错：帧丢失、帧重复或帧失序等

## PPP 协议
#### PPP 协议的组成
- 一个将IP 数据报封装到串行链路的方法。
- 一个链路控制协议LCP (Link Control Protocol)。
- 一套网络控制协议NCP (Network Control Protocol)。
#### PPP 帧格式
![[Pasted image 20241106110938.png]]
## CSMA/CD 协议
- 局域网共享信道的方法
	- 静态划分信道[[物理层]]
	- 动态媒体接入控制（多点接入）
		- 随机接入
			- 所有用户可随便发送信息，这需要解决冲突的网络协议
			- 典型应用：以太网
		- 受控接入
- 适配器
	- 实现计算机 I/O 与外界局域网（电缆）的连接
	- 实现串并转换
	- 实现以太网协议
- CSMA/CD 
	- 含义：载波监听多点接入/ 碰撞检测 (Carrier Sense Multiple Access with Collision Detection)
		- “多点接入”表示许多计算机以多点接入的方式连接 在一根总线上。
		- “载波监听”是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有， 则暂时不要发送数据，以免发生碰撞。
		- “碰撞检测”就是计算机边发送数据边检测信道上的信 号电压大小。电压摆动值超过一定的门限值时，就认 为总线上至少有两个站同时在发送数据，表明产生了碰撞（或冲突）。
			- 检测到碰撞后：
				- 适配器立即停止发送。
				- 等待一段随机时间后再次发送。免得浪费通信资源
	- 工作流程
		- ![[Pasted image 20241106115011.png]]
		- 强化碰撞
			- 发送站检测到冲突后，立即停止发送数据帧，接着就发送 32 或 48 比特的人为干扰信号 (jamming signal) 。
			- ![[Pasted image 20241106114946.png]]
	- 分析
		- A需要单程传播时延的2倍的时间，才能检测到与B的发送产生了冲突
		- 争用期
			- 以太网的端到端往返时延 $2\tau$ 称为争用期，或碰撞窗口。每一个站在自己发送数据之后的这一小段时间内，存在着遭遇碰撞的可能性
			- 争用期的长度= $51.2 \mu s$
			- 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。
			- 以太网的最大端到端长度（覆盖范围）
				- 以太网最大端到端单程时延必须小于争用期的一半(即25.6 μs)， 相当于以太网的最大端到端长度约为5 km。
			- 参数 $\alpha$
				- $\alpha=\frac{\tau}{T_0}$，发送帧需要的时间是 $T_0$
				- 要提高以太网的信道利用率，就必须减小 $\tau$ 与 T0 之比。
				- ![[Pasted image 20241106115856.png]]
		- 碰撞后重传的时机
			- 采用截断二进制指数退避 (truncated binary exponential backoff) 确定。
				- 发生碰撞的站停止发送数据后，要退避一个随机时间后再发送数据。
				- ![[Pasted image 20241106114415.png]]
		- 举例
			- ![[Pasted image 20241106114806.png]]
	- CSMA/CD 协议的重要特征
		- 使用 CSMA/CD 协议的以太网不能进行全双工通信而只能进行双向交替通信（半双工通信）。
		- 这种发送的不确定性使整个以太网的平均通信量远小于以太网的最高数据率。

## 使用集线器的星形拓扑
- 集线器
	- 集线器是使用电子器件来模拟实际电缆线的工作， 因此整个系统仍然像一个传统的以太网那样运行。
	- 使用集线器的以太网在逻辑上仍是一个总线网， 各工作站使用的还是CSMA/CD 协议，并共享逻辑 上的总线。
	- 集线器很像一个多接口的转发器。工作在物理层， 不进行碰撞检测。
## 以太网的 MAC 层
#### MAC 地址
- 在局域网中，硬件地址又称为物理地址，或MAC 地址。
- MAC地址是局域网通信设备或端口的唯一标识符。
	- 格式
		- 48 位（6 字节）
		- IEEE 注册管理机构RA 负责向厂家分配前3 个字节(即高24 位)，称 为组织唯一标识符OUI
			- 其中第一字节的最低位为 I/G 位
				- 当 I/G位=0 时，地址字段表示一个单站地址
				- 当 I/G 位=1 时，表示组地址，用来进行多播（一对多）
		- 厂家自行指派后3 个字节(即低24 位)，称为扩展标识符(extended identifier)。
		- 所有48 位都为1 时，为广播地址（一对全体）。只能作为目的地址使用。
#### MAC 帧
![[Pasted image 20241106120513.png]]
在帧的前面插入（硬件生成）的8 字节中，第一个字段共7 个字节，是前同步码，用来迅速实现 MAC 帧的比特同步。第二个字段 1 个字节是帧开始定界符，表示后面的信息就是 MAC 帧。

## 扩展的以太网
### 在物理层扩展以太网
- 碰撞域
	- 碰撞域（collision domain）又称为冲突域，指网络中一个站点发出的帧会与其他站点发出的帧产生碰撞或冲突的那部分网络。
	- 碰撞域越大，发生碰撞的概率越高。
#### 使用集线器扩展
使用多个集线器可连成更大的、多级星形结构的以太网。
![[Pasted image 20241106122515.png]]
### 在数据链路层扩展以太网
#### 使用网桥或交换机
- 网桥
	- 网桥根据MAC 帧的目的地址对收到的帧进行转发和过滤
	- 当网桥收到一个帧时，并不是向所有的接口转发此帧，而是先检查此帧的目的MAC 地址，然后再确定将该帧转发到哪 一个接口，或把它丢弃。
- 交换机
	- 以太网交换机实质上就是一个多接口的网桥，**每个接口都是一个碰撞域**
	- 每个接口都直接与一个单台主机或另一个以太 网交换机相连，并且一般都工作在全双工方式。
	- 以太网交换机具有并行性。
		- 能同时连通多对接口，使多对主机能同时通信。
	- 相互通信的主机都是独占传输媒体，无碰撞地传输数据
	- 从共享总线以太网转到交换式以太网时，所有接入设 备的软件和硬件、适配器等都不需要做任何改动。
	- ![[Pasted image 20241106123427.png]]
	- 以太网交换机的自学习功能
		- 交换表
			- ![[Pasted image 20241106124315.png]]
		- 开始时，以太网交换机里面的交换表是空的。
			- A 先向 B 发送一帧，从接口 1 进入到交换机。
				- 交换机收到帧后，先查找交换表，没有查到应从哪个接口转发这个帧。
				- 交换机把这个帧的源地址 A 和接口1 写入交换表中，并向除接口1以外的所有的接口广播这个帧。
				- C 和 D 将丢弃这个帧，因为目的地址不对。只 B 才收 下这个目的地址正确的帧。这也称为过滤。
				- 从新写入交换表的项目 (A, 1) 可以看出，以后不管从哪一个接口收到帧，只要其目的地址是 A，就应当把收到的帧从接口1转发出去。
			- B 通过接口 3 向 A 发送一帧。
				- 交换机查找交换表，发现交换表中的 MAC 地址有 A。 表明要发送给A的帧（即目的地址为 A 的帧）应从接 口1转发。于是就把这个帧传送到接口 1 转发给 A。
				- 交换表这时新增加的项目 (B, 3)，表明今后如有发送给 B 的帧，就应当从接口 3 转发出去。
			- ![[Pasted image 20241106124621.png]]
		- ![[Pasted image 20241106124758.png]]